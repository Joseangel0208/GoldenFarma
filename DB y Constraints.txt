CREATE DATABASE GOLDENFARMADB
GO
USE GOLDENFARMADB

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Medicina_Laboratorio]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Medicina] DROP CONSTRAINT [FK_Medicina_Laboratorio]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Vendedor_Venta]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Vendedor] DROP CONSTRAINT [FK_Vendedor_Venta]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Venta_Medicina]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Venta] DROP CONSTRAINT [FK_Venta_Medicina]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Venta_Cliente]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Venta] DROP CONSTRAINT [FK_Venta_Cliente]
GO

/* Drop Tables */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Cliente]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Cliente]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Laboratorio]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Laboratorio]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Medicina]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Medicina]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Vendedor]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Vendedor]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Venta]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Venta]
GO

/* Create Tables */

CREATE TABLE [Cliente]
(
	[Id_cliente] varchar(8) NULL,
	[Nombre] nvarchar(50) NULL,
	[Telefono] varchar(50) NULL,
	[ClienteID] varchar(8) NOT NULL,
	[Direccion] nvarchar(50) NULL
)
GO

CREATE TABLE [Laboratorio]
(
	[Direccion] varchar(50) NULL,
	[Id_lab] int NULL,
	[Nombre] nvarchar(50) NULL,
	[LaboratorioID] varchar(10) NOT NULL
)
GO

CREATE TABLE [Medicina]
(
	[Cantidad] int NULL,
	[Descripcion] nvarchar(100) NULL,
	[Id_producto] int NULL,
	[Nombre] nvarchar(50) NULL,
	[Precio] float NULL,
	[MedicinaID] varchar(10) NOT NULL,
	[LaboratorioID] varchar(10) NOT NULL,
	[VentaID] varchar(15) NOT NULL
)
GO

CREATE TABLE [Vendedor]
(
	[Apellido] nvarchar(50) NULL,
	[Id_vendedor] nvarchar(10) NULL,
	[Nombre] nvarchar(50) NULL,
	[VendedorID] int NOT NULL,
	[VentaID] varchar(15) NOT NULL
)
GO

CREATE TABLE [Venta]
(
	[Cantidad] int NOT NULL,
	[Id_vendedor] nvarchar(50) NULL,
	[Id_venta] nvarchar(50) NULL,
	[Precio] float NULL,
	[VentaID] varchar(15) NOT NULL,
	[ClienteID] varchar(8) NOT NULL,
	[MedicinaID] varchar(10) NULL
)
GO

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE [Cliente] 
 ADD CONSTRAINT [PK_Cliente]
	PRIMARY KEY CLUSTERED ([ClienteID] ASC)
GO

ALTER TABLE [Laboratorio] 
 ADD CONSTRAINT [PK_Laboratorio]
	PRIMARY KEY CLUSTERED ([LaboratorioID] ASC)
GO

ALTER TABLE [Medicina] 
 ADD CONSTRAINT [PK_Medicina]
	PRIMARY KEY CLUSTERED ([MedicinaID] ASC)
GO

ALTER TABLE [Vendedor] 
 ADD CONSTRAINT [PK_Vendedor]
	PRIMARY KEY CLUSTERED ([VendedorID] ASC)
GO

ALTER TABLE [Venta] 
 ADD CONSTRAINT [PK_Venta]
	PRIMARY KEY CLUSTERED ([VentaID] ASC)
GO

/* Create Foreign Key Constraints */

ALTER TABLE [Medicina] ADD CONSTRAINT [FK_Medicina_Laboratorio]
	FOREIGN KEY ([LaboratorioID]) REFERENCES [Laboratorio] ([LaboratorioID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Vendedor] ADD CONSTRAINT [FK_Vendedor_Venta]
	FOREIGN KEY ([VentaID]) REFERENCES [Venta] ([VentaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Venta] ADD CONSTRAINT [FK_Venta_Medicina]
	FOREIGN KEY ([MedicinaID]) REFERENCES  [Medicina] ([MedicinaID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Venta] ADD CONSTRAINT [FK_Venta_Cliente]
	FOREIGN KEY ([ClienteID]) REFERENCES [Cliente] ([ClienteID]) ON DELETE No Action ON UPDATE No Action
GO
ALTER TABLE CLIENTE	
	--ADD CONSTRAINT DF_DIRECCION DEFAULT 'MANAGUA' FOR Direccion
	--ADD CONSTRAINT UQ_TELEFONO UNIQUE (Telefono)



/*
Commands completed successfully.

Completion time: 2022-11-14T11:31:44.9965082-05:00
*/

ALTER TABLE Venta
ADD CONSTRAINT CK_Cantidad CHECK(Cantidad>0)

/*
Commands completed successfully.

Completion time: 2022-11-14T11:35:38.9310404-05:00
*/